function initMap(){if(google){var a=[{featureType:"all",elementType:"geometry",stylers:[{hue:"#a47a40"},{saturation:-8}]},{featureType:"poi.park",elementType:"geometry",stylers:[{hue:"#93BF9A"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{hue:"#91102C"}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:4.732743,lng:-74.0589},zoom:12,styles:a}),localStorage.restaurants&&ko.applyBindings(viewModel)}else alert("Failed to load Google APIs")}var enableInit=!1;!function(){var a="https://api.foursquare.com/v2/venues/search?";a+=$.param({near:"Bogota",categoryId:"4bf58dd8d48988d142941735,55a59bace4b013909087cb24",limit:50,client_id:"4BT03HQEPTGWRUWGW40PEEGSXRBH3X5WJZETXAEYHFZNTWYQ",client_secret:"VSVSDNA3SFNRIHCO14BYKKZOPFAIU525N3IQQ5YNJB5YHODP",v:20160101,m:"foursquare"}),$.ajax({url:a,dataType:"json",success:function(a){console.log(a.response.venues),localStorage.restaurants||(localStorage.restaurants=JSON.stringify(a.response.venues),ko.applyBindings(viewModel))},error:function(){alert("Failed to load Foursquare info")}})}();var map,Restaurant=function(a){this.name=a.name,this.people=a.hereNow.count,this.address=a.location.address,this.cusine=a.categories[0].shortName,this.location=a.location,this.visible=ko.observable(a.visible),this.infowindowTitle="<h3>%data%</h3>",this.fish="img/fish.png",this.cover="img/covering.png",this.marker=new google.maps.Marker({position:this.location,animation:google.maps.Animation.DROP,icon:this.fish})};Restaurant.prototype.populateInfoWindow=function(a,b){function c(a,b){if(b==google.maps.StreetViewStatus.OK){var c=new google.maps.StreetViewPanorama(document.getElementById("pano"));c.setPosition(d.location)}else document.getElementById("pano").classList.add("error"),document.getElementById("pano").innerHTML='<i class="fa fa-exclamation-triangle fa-4x"" aria-hidden="true"></i>',document.getElementById("pano").innerHTML+='<div class="error-message"><h2>Sorry :(</h2><p>We could not find a Google Street View for '+d.name+"</p></div>"}var d=this;if(this.title=d.infowindowTitle.replace("%data%",d.name),this.image='<div id="pano"><div>',this.infoWindowContent=this.title+this.image,console.dir(a),console.dir(b.marker),b.marker!=a){b.marker=a,b.setContent(this.infoWindowContent),b.addListener("closeclick",function(){b.marker=null});var e=new google.maps.StreetViewService,f=50;e.getPanoramaByLocation(a.position,f,c),b.open(map,a)}b.open(map,a)};var viewModel=function(){var a=this;a.restaurantsArray=ko.observableArray();var b=JSON.parse(localStorage.restaurants);b.forEach(function(b){a.restaurantsArray.push(new Restaurant(b))});var c=new google.maps.InfoWindow;Restaurant.prototype.displayInfoWindow=function(){this.populateInfoWindow(this.marker,c)},a.restaurantsArray().forEach(function(a){a.marker.addListener("click",function(){a.populateInfoWindow(a.marker,c),a.marker.setIcon(a.cover)})}),a.foodTypes=["All"],a.restaurantsArray().forEach(function(b){var c=a.foodTypes.indexOf(b.cusine);c===-1&&a.foodTypes.push(b.cusine)}),a.selectedfoodType=ko.observable("All"),a.filterRestaurants=ko.computed(function(){var b,c=a.selectedfoodType();return ko.utils.arrayFilter(a.restaurantsArray(),function(a){return(b="All"===c||c===a.cusine)?(a.marker.setMap(map),b):void a.marker.setMap(null)})})};